# 示例

## 编译

在官网下载源代码， https://think-async.com/Asio/ 然后，执行下面的命令。我下载的asio是不带boost前缀的，其实有一个带boost前缀的asio。不带前缀的只需要include头文件就好了，所以我选择了他。

```sh
./configure
make
sudo make install
```

然后完事了，别忘记更新一下链接库的缓存，不更新也没关系，反正这个demo不需要连接库。
## 代码

```cpp
#include <asio/buffer.hpp>
#include <asio/io_context.hpp>
#include <asio/ip/address.hpp>
#include <asio/ip/tcp.hpp>
#include <asio/write.hpp>
#include <iostream>

using asio::ip::tcp;

int main(int argc, char** argv){
    if (argc == 1){

        char data[1024] = {0};
        asio::error_code error;
            
        asio::io_context io_context;
        tcp::socket sock(io_context);
        tcp::acceptor acptr(io_context, tcp::endpoint(tcp::v4(), 6688));

        acptr.accept(sock);
        std::cout << "client:" << sock.remote_endpoint().address() << " " << sock.remote_endpoint().port() << std::endl;

        size_t length = sock.read_some(asio::buffer(data), error);

        std::cout << data << std::endl;

    }else {
        asio::io_context io_context;
        tcp::socket sock(io_context);
        sock.connect(tcp::endpoint(asio::ip::make_address("127.0.0.1"), 6688));

        asio::write(sock, asio::buffer("hello server"));
    }
}
```

你编译好之后，之间运行就是server模式，随便加什么参数就是client模式。

## 吐槽一下

API `asio::ip::address::from_string`不知道为什么没了，还好我在头文件中找到了一个替代API，`asio::ip::make_address`

## 参考资料

1. https://zhuanlan.zhihu.com/p/653637889
