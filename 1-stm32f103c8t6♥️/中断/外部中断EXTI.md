# å¤–éƒ¨ä¸­æ–­EXTI

## å¼•è„šå¯¹åº”çš„å¤–éƒ¨ä¸­æ–­

å¤–éƒ¨ä¸­æ–­åªæœ‰16ä¸ªï¼Œå¼•è„šç¼–å·å°±å¯¹åº”å¤–éƒ¨ä¸­æ–­ï¼Œä¸åˆ†å¼•è„šç»„ABCDçš„ã€‚

æ¯”å¦‚PA1å’ŒPB1éƒ½å¯¹åº”ä¸€ä¸ªEXTI1ã€‚

å¤–éƒ¨ä¸­æ–­åªæœ‰1ã€2ã€3ã€4ã€5ï½ž9ã€10ï½ž15ï¼Œ6ä¸ªæŽ§åˆ¶å‡½æ•°ã€‚æ¯”è¾ƒå°‘ï¼ŒðŸ˜…æ— è¯­äº†ã€‚è¿™å°±æ˜¯æˆ‘ä»¬é«˜çº§çš„stm32c8t6å—ï¼Ÿä½†æ˜¯ä½ å¯ä»¥å¼ºè¡Œè¯»å–å¼•è„šç”µå¹³ï¼Œè¿™æ ·å¯ä»¥å‹‰å¼ºåˆ¤æ–­è°è¢«æŒ‰ä¸‹äº†ï¼Œå½±å“ä¸å¤§ï¼Œè¯´å®žè¯ï¼Œå°±æ˜¯å†™ä»£ç éš¾åº¦é«˜äº†ä¸€ç‚¹ç‚¹è€Œå·²ã€‚

## è®¾ç½®GPIOä¸‹é™æ²¿è§¦å‘ä¸­æ–­

```c
// 1. å¼€å¯æ—¶é’Ÿ (AFIOæ—¶é’Ÿéžå¸¸å…³é”®ï¼)
__HAL_RCC_GPIOA_CLK_ENABLE();
// å¦‚æžœä½ æ˜¯ä»Žcubemxç”Ÿæˆçš„é¡¹ç›®æ¥çš„è¯ï¼Œè¿™ä¸ªå·²ç»åœ¨stm32f1xx_hal_msp.cè¢«å¯ç”¨è¿‡äº†ï¼Œä¹Ÿå°±æ˜¯HAL_Init()å‡½æ•°ä¸­ä»¥åŠè°ƒç”¨äº†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å¯ä»¥ä¸å¿…å†™è¿™ä¸ªã€‚å½“ç„¶å¦‚æžœä½ åŠ ä¸Šå…¶å®žä¹Ÿæ²¡æœ‰å…³ç³»çš„ï¼Œé‡å¤æ‰§è¡Œè¿™ä¸ªä»£ç æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚
__HAL_RCC_AFIO_CLK_ENABLE();

// 2. é…ç½®GPIOç»“æž„ä½“å¹¶åˆå§‹åŒ–
GPIO_InitTypeDef GPIO_InitStruct = {0};
GPIO_InitStruct.Pin = GPIO_PIN_5;
GPIO_InitStruct.Mode = GPIO_MODE_IT_FALLING;  // è®¾ç½®ä¸ºä¸‹é™æ²¿è§¦å‘ä¸­æ–­
GPIO_InitStruct.Pull = GPIO_PULLUP;           // æ ¹æ®ä½ çš„ç”µè·¯é€‰æ‹©ä¸Šæ‹‰æˆ–ä¸‹æ‹‰
HAL_GPIO_Init(GPIOA, &GPIO_InitStruct);

// 3. é…ç½®å¹¶å¯ç”¨NVICä¸­æ–­
// EXTI5~EXTI9çš„ä¸­æ–­é€šé“æ˜¯ EXTI9_5_IRQn
HAL_NVIC_SetPriority(EXTI9_5_IRQn, 1, 0); // è®¾ç½®ä¼˜å…ˆçº§ï¼Œæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜
HAL_NVIC_EnableIRQ(EXTI9_5_IRQn);         // ä½¿èƒ½ä¸­æ–­é€šé“
```

è¿™é‡Œè®¾ç½®ä¸º1æ¯”è¾ƒä¿é™©ï¼Œå› ä¸ºHAL_Delayåº•å±‚æ˜¯ä¾é ä¸­æ–­å®žçŽ°çš„ï¼Œä»–çš„ä¸­æ–­ä¼˜å…ˆçº§æ˜¯0ï¼Œä¹Ÿå°±æ˜¯è¯´æ˜¯æœ€é«˜çš„ã€‚è®¾ç½®ä¸º1å°±ä¸ä¼šå¼•èµ·å†²çªï¼Œé˜²æ­¢ç¨‹åºè·‘é£žã€‚å½“ç„¶å¦‚æžœä½ çš„ä¸­æ–­ä¸ç”¨HAL_Delayï¼Œé‚£å½“æˆ‘æ²¡è¯´ã€‚

## è¦†å†™ä¸­æ–­å¤„ç†å‡½æ•°

è¿™ä¸¤ä¸ªå‡½æ•°éƒ½å¿…é¡»è¦è¦†å†™æ‰è¡Œï¼

```c
// å¤–éƒ¨ä¸­æ–­[15:10]çš„å¤„ç†å‡½æ•°ï¼ŒHAL_GPIO_EXTI_Callbackä»Žæ­¤å¤„è¢«è°ƒç”¨ã€‚
void EXTI15_10_IRQHandler(void){
	// æ¶ˆä½ä¸­æ–­æ ‡è®°ï¼Œè°ƒç”¨Callback
	HAL_GPIO_EXTI_IRQHandler(GPIO_PIN_5);
}

// å¤–éƒ¨ä¸­æ–­Callbackï¼Œç”±HAL_GPIO_EXTI_IRQHandlerè§¦å‘
void HAL_GPIO_EXTI_Callback(uint16_t GPIO_Pin){
	// å†æ¬¡ç¡®è®¤æ˜¯å¦æŒ‰ä¸‹KEY1
	if(HAL_GPIO_ReadPin(KEY1_GPIO_Port, KEY1_Pin) == 0){
		// ç»¿ç¯ç¿»è½¬
		HAL_GPIO_TogglePin(GREEN_GPIO_Port, GREEN_Pin);
		// ç­‰å¾…æŒ‰é”®é‡Šæ”¾
		while(HAL_GPIO_ReadPin(KEY1_GPIO_Port, KEY1_Pin) == 0);
	}
}
```


> [!tips]
> `EXTI15_10_IRQHandler`çš„weakå£°æ˜Žåœ¨`startup_stm32f103c8tx.s`ä¸­ï¼Œ`HAL_GPIO_EXTI_Callback`çš„weakå£°æ˜Žåœ¨`stm32f1xx_hal_gpio.c`ä¸­ã€‚

## CubeMXé¡¹ç›®

Cubemxä¸­ï¼ŒIRQHandlerç›¸å…³çš„å‡½æ•°ä¸€èˆ¬æ”¾åœ¨`stm32f1xx_it.c`æ–‡ä»¶ä¸­ã€‚
