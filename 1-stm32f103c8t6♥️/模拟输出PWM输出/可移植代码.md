# 可移植代码(仅仅作为参考)

```c
// 防止重复初始化
char is_tim1_inited = 0;
char is_tim2_inited = 0;
char is_tim3_inited = 0;
char is_tim4_inited = 0;

TIM_HandleTypeDef htim1;
TIM_HandleTypeDef htim2;
TIM_HandleTypeDef htim3;
TIM_HandleTypeDef htim4;

TIM_ClockConfigTypeDef sClockSourceConfig = {0};
TIM_MasterConfigTypeDef sMasterConfig = {0};
TIM_OC_InitTypeDef sConfigOC = {0};

GPIO_InitTypeDef GPIO_InitStruct = {0};

void Error_Handler(){
	while (1){
	
	}
}

void TIM1_Init(){
	// 防止重复初始化
	if (is_tim1_inited) return;
	else is_tim1_inited = 1;
	
	// 使能TIM
	__HAL_RCC_TIM1_CLK_ENABLE();
	
	// 初始化TIM计数器
	htim1.Instance = TIM1;
	htim1.Init.Prescaler = 72-1; // 设置预分频器
	htim1.Init.CounterMode = TIM_COUNTERMODE_UP; // 上升计数
	htim1.Init.Period = 100-1; // 设置自动重装载指
	htim1.Init.ClockDivision = TIM_CLOCKDIVISION_DIV1;
	htim1.Init.AutoReloadPreload = TIM_AUTORELOAD_PRELOAD_DISABLE;
	if (HAL_TIM_Base_Init(&htim1) != HAL_OK){
		Error_Handler();
	}
	
	// 配置时钟源
	sClockSourceConfig.ClockSource = TIM_CLOCKSOURCE_INTERNAL; // 就是内部时钟源APB1
	
	if (HAL_TIM_ConfigClockSource(&htim1, &sClockSourceConfig) != HAL_OK){
		Error_Handler();
	}
}

void TIM2_Init(){
	// 防止重复初始化
	if (is_tim2_inited) return;
	else is_tim2_inited = 1;
	
	// 使能TIM
	__HAL_RCC_TIM2_CLK_ENABLE();
	
	// 初始化TIM计数器
	htim2.Instance = TIM2;
	htim2.Init.Prescaler = 72-1; // 设置预分频器
	htim2.Init.CounterMode = TIM_COUNTERMODE_UP; // 上升计数
	htim2.Init.Period = 100-1; // 设置自动重装载指
	htim2.Init.ClockDivision = TIM_CLOCKDIVISION_DIV1;
	htim2.Init.AutoReloadPreload = TIM_AUTORELOAD_PRELOAD_DISABLE;
	if (HAL_TIM_Base_Init(&htim2) != HAL_OK){
		Error_Handler();
	}
	
	// 配置时钟源
	sClockSourceConfig.ClockSource = TIM_CLOCKSOURCE_INTERNAL; // 就是内部时钟源APB1
	
	if (HAL_TIM_ConfigClockSource(&htim2, &sClockSourceConfig) != HAL_OK){
		Error_Handler();
	}
}

void TIM3_Init(){
	// 防止重复初始化
	if (is_tim3_inited) return;
	else is_tim3_inited = 1;
	
	// 使能TIM
	__HAL_RCC_TIM3_CLK_ENABLE();
	
	// 初始化TIM计数器
	htim3.Instance = TIM3;
	htim3.Init.Prescaler = 72-1; // 设置预分频器
	htim3.Init.CounterMode = TIM_COUNTERMODE_UP; // 上升计数
	htim3.Init.Period = 100-1; // 设置自动重装载指
	htim3.Init.ClockDivision = TIM_CLOCKDIVISION_DIV1;
	htim3.Init.AutoReloadPreload = TIM_AUTORELOAD_PRELOAD_DISABLE;
	if (HAL_TIM_Base_Init(&htim3) != HAL_OK){
		Error_Handler();
	}
	
	// 配置时钟源
	sClockSourceConfig.ClockSource = TIM_CLOCKSOURCE_INTERNAL; // 就是内部时钟源APB1
	
	if (HAL_TIM_ConfigClockSource(&htim3, &sClockSourceConfig) != HAL_OK){
		Error_Handler();
	}
}

void TIM4_Init(){
	// 防止重复初始化
	if (is_tim3_inited) return;
	else is_tim3_inited = 1;
	
	// 使能TIM
	__HAL_RCC_TIM4_CLK_ENABLE();
	
	// 初始化TIM计数器
	htim4.Instance = TIM4;
	htim4.Init.Prescaler = 72-1; // 设置预分频器
	htim4.Init.CounterMode = TIM_COUNTERMODE_UP; // 上升计数
	htim4.Init.Period = 100-1; // 设置自动重装载指
	htim4.Init.ClockDivision = TIM_CLOCKDIVISION_DIV1;
	htim4.Init.AutoReloadPreload = TIM_AUTORELOAD_PRELOAD_DISABLE;
	
	if (HAL_TIM_Base_Init(&htim4) != HAL_OK){
		Error_Handler();
	}
	
	// 配置时钟源
	sClockSourceConfig.ClockSource = TIM_CLOCKSOURCE_INTERNAL; // 就是内部时钟源APB1
	if (HAL_TIM_ConfigClockSource(&htim4, &sClockSourceConfig) != HAL_OK){
		Error_Handler();
	}
}

void T1C1_Msp_Init(){
	_HAL_RCC_GPIOA_CLK_ENABLE();
	
	GPIO_InitStruct.Pin = GPIO_PIN_8;
	
	GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
	GPIO_InitStruct.Pull = GPIO_NOPULL;
	GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
	
	HAL_GPIO_Init(GPIOA, &GPIO_InitStruct);
}

void T1C1_Init(){
	TIM1_Init();
	T1C1_Msp_Init();
	
	// 配置PWM Channel
	if (HAL_TIM_PWM_Init(&htim1) != HAL_OK){
		Error_Handler();
	}
	sMasterConfig.MasterOutputTrigger = TIM_TRGO_RESET;
	sMasterConfig.MasterSlaveMode = TIM_MASTERSLAVEMODE_DISABLE; // TIM独立工作
	if (HAL_TIMEx_MasterConfigSynchronization(&htim1, &sMasterConfig) != HAL_OK){
		Error_Handler();
	}
	sConfigOC.OCMode = TIM_OCMODE_PWM1; // 设置为PWM模式1，前半段有效后半段无效电平
	sConfigOC.Pulse = 0; // 设置输出比较寄存器的值
	sConfigOC.OCPolarity = TIM_OCPOLARITY_HIGH; // 设置有效电平为高电平
	sConfigOC.OCFastMode = TIM_OCFAST_DISABLE;
	if (HAL_TIM_PWM_ConfigChannel(&htim1, &sConfigOC, TIM_CHANNEL_1) != HAL_OK){
		Error_Handler();
	}
}

void T1C2_Msp_Init(){
	_HAL_RCC_GPIOA_CLK_ENABLE();
	
	GPIO_InitStruct.Pin = GPIO_PIN_9;
	
	GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
	GPIO_InitStruct.Pull = GPIO_NOPULL;
	GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
	
	HAL_GPIO_Init(GPIOA, &GPIO_InitStruct);
}

void T1C2_Init(){
	TIM1_Init();
	T1C1_Msp_Init();
	
	// 配置PWM Channel
	if (HAL_TIM_PWM_Init(&htim1) != HAL_OK){
		Error_Handler();
	}
	sMasterConfig.MasterOutputTrigger = TIM_TRGO_RESET;
	sMasterConfig.MasterSlaveMode = TIM_MASTERSLAVEMODE_DISABLE; // TIM独立工作
	if (HAL_TIMEx_MasterConfigSynchronization(&htim1, &sMasterConfig) != HAL_OK){
		Error_Handler();
	}
	sConfigOC.OCMode = TIM_OCMODE_PWM1; // 设置为PWM模式1，前半段有效后半段无效电平
	sConfigOC.Pulse = 0; // 设置输出比较寄存器的值
	sConfigOC.OCPolarity = TIM_OCPOLARITY_HIGH; // 设置有效电平为高电平
	sConfigOC.OCFastMode = TIM_OCFAST_DISABLE;
	if (HAL_TIM_PWM_ConfigChannel(&htim1, &sConfigOC, TIM_CHANNEL_2) != HAL_OK){
		Error_Handler();
	}
}
```