# 实现逻辑
1. *前方有物体时，DO引脚输出低电平*，STM32上的任一引脚检测电平状态，判断高低电平，判断电平是否变化。电平变化时触发*中断*，中断回调函数需要实现向*串口*发送信息同时*点亮LED*的功能。
2. 需要什么量
rurrent_state:描述DO引脚现在的电平状态，需要经常改变，用volatile修饰
new_state:new_state=HAL_GPIO_ReadPin(GPIOA,GPIO_PIN_0
txData:串口发送信息
rxData：串口接受信息
3. 函数
初始化外部中断
void HAL_GPIO_EXTI_Callback(uint8_t GPIO_PIN){
	if(GPIO_PIN == GPIO_PIN_0){
		HAL_Delay(5);
		//其他复杂代码	
	}
}
初始化串口中断
![[Pasted image 20251127145222.png]]
# 项目感悟
![[Pasted image 20251127193915.png]]
1. 状态机编程，定义*现在的状态，新状态，状态改变*
2. 自定义外部中断回调函数和触发中断时功能实现函数
外部中断函数，主要是判断状态，及状态改变
![[Pasted image 20251127194303.png]]
>[!NOTE] 中断回调函数中不能使用延时函数HAL_Delay()

功能实现函数
![[Pasted image 20251127194730.png]]
3. 主函数部分main
初始化GPIO，串口发送欢迎信息
![[Pasted image 20251127195002.png]]
while死循环中
![[Pasted image 20251127195136.png]]
>[!NOTE] 死循环中Delay一下可以释放CPU资源

接线

| 红外  | STM32 |
| --- | ----- |
| D0  | A0    |

| 小灯  | STM32 |
| --- | ----- |
| 红   | A6    |
| 黄   | A7    |
串口RX，PA9
TX，PA0
# test3

