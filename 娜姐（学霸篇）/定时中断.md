## 定时器的三大核心应用：
精准定时：替代HAL_Delay实现非阻塞延时（不占用主循环）；
周期性任务：如每 10ms 采集一次传感器数据、每 1 秒更新一次屏幕显示；
脉冲测量：测量外部信号的频率、占空比。
## 定时器类型 型号（F103C8T6 为例） 核心特点 典型应用
1. 高级定时器 *TIM1* 支持 PWM 互补输出、死区控制，带刹车功能 电机驱动（需要互补 PWM）
2. 通用定时器 *TIM2、TIM3、TIM4、TIM5* 支持定时中断、PWM 输出、输入捕获，16 位计数器 精准定时、普通 PWM 控制（LED 调光、风扇调速）
3. 基本定时器 *TIM6、TIM7* 仅支持定时中断，无 PWM / 捕获功能 简单定时（如触发 ADC 转换）
## 通用定时器（以 TIM3 为例）的核心参数：
16 位计数器（计数范围 0~65535）；
时钟源可选（内部 APB1 时钟、外部引脚信号等）；
支持向上 / 向下 / 中心对齐计数；
可产生更新中断（计数到目标值时触发）。
## 核心公式：定时时间 = (PSC+1) × (ARR+1) / 定时器时钟频率
PSC（预分频器）：降低定时器的计数频率。例如，时钟频率 72MHz，PSC=71，则计数频率 = 72MHz/(71+1)=1MHz（每 1μs 计数一次）；
ARR（自动重装载寄存器）：计数器的目标值。当计数器从 0 计数到 ARR 时，触发中断并重置为 0（向上计数模式）；
定时时间：计数器从 0 到 ARR 的总耗时（单位：秒）。
## 工作流程（向上计数模式）：
定时器时钟经 PSC 分频后，得到 “计数时钟”（如 1MHz，即每 1μs 跳变一次）；
计数器从 0 开始，每过 1 个计数时钟就 + 1；
当计数器的值 = ARR 时，触发 “更新中断”（通知 NVIC），同时计数器自动重置为 0，重复计数；
NVIC 响应中断，CPU 执行定时器中断服务函数（如翻转 LED、更新数据）。
## 案例“TIM3 每 100ms 触发一次中断，中断中计数，累计 10 次（即 1 秒）后翻转 LED” 的案例
步骤 1：使能 TIM3 并配置时钟
新建工程（或沿用旧工程），进入 “Pinout & Configuration” 界面；
左侧 “Timers”→“TIM3”，在 “Mode” 选项卡中：
“Clock Source” 选择 “Internal Clock”（使用内部 APB1 时钟）；
其他默认（暂不配置中断）。
步骤 2：配置定时参数（PSC 和 ARR）
切换到 “Configuration” 选项卡，配置 “Counter Settings”：
“Prescaler (PSC)”：输入35999（36MHz/(35999+1)=1kHz，即 1ms 计数一次）；
“Counter Mode”：选择 “Up”（向上计数）；
“Auto-reload preload”：选择 “Enable”（使能自动重装载，ARR 值修改后立即生效）；
“Counter Period (ARR)”：输入99（0~99 共 100 次计数，每次 1ms，总定时 100ms）；
其他参数默认（如 “Clock Division” 保持 0）。
步骤 3：使能定时器更新中断
在 “NVIC Settings” 选项卡中：
勾选 “TIM3 global interrupt” 的 “Enabled”（使能 TIM3 中断）；
配置优先级：“Preemption Priority”=1，“Sub Priority”=1（可根据需求调整，只要不低于主程序即可）。
步骤 4：配置 LED 引脚（PA5）
同第 1 篇：PA5 设为 “GPIO_Output”（推挽输出，无上下拉，低速）。
步骤 5：生成代码
点击 “Generate Code”，CubeIDE 会自动生成 TIM3 初始化代码和中断向量配置。
![[Screenshot_2025-11-20-22-37-50-87_149003a2d400f6a.jpg]]

# 项目感悟
![[Pasted image 20251123202953.png]]
![[Pasted image 20251124211720.png]]
1. 打开内部时钟源和全局中断
2. 打开全局中断（NVIC）
3. 中断调用函数
![[Pasted image 20251123203221.png]]
4. 初始化（int main）中
![[Pasted image 20251123203356.png]]
小灯PB4