# USART通信

## 省流版本

低配通信方式，在`Serial.begin([波特率])`之后，用`Serial.print()`就可以通信了。

## 细节版本

当你已经能用 Arduino 让一盏小灯闪烁、让电机转动之后，很自然地就会冒出下一个想法：​**​如何让两块 Arduino 板子之间说说话？​**​ 或者，​**​如何让 Arduino 和电脑交换数据？​**​ 这时候，USART（通用同步/异步收发传输器）就派上用场了，而它最常见的工作模式，就是我们常说的​**​串口通信​**​（Serial Communication）。

你可以把它想象成电子设备之间的一场“对话”，但它遵循着非常严格（也因此非常可靠）的礼仪规则。想象一下，两个人要隔着一条很窄的走廊传递信息，他们不能同时朝对方喊话，否则就会听不清。于是他们约定好：一个人说的时候，另一个人只能听；说完一句后，等待对方回应。并且，他们必须以完全相同的语速说话，如果一个人说得飞快，另一个人却慢悠悠地听，那听到的必然是一堆毫无意义的乱码。

这套“礼仪规则”，就是 USART（异步模式下）的核心。

​**​细节体现在哪里呢？​**​

首先，是那根“很窄的走廊”——通信线路。在大多数情况下，你只需要三根线就能完成双向对话：一根用于发送（TX），一根用于接收（RX），还有一根共同的地线（GND）作为电压参考基准。发送端（比如 Arduino A）的 TX 引脚会精确地、按顺序地产生一连串高高低低的电压信号，就像在拍发电报的“点”和“划”。这些信号通过导线，原封不动地传递到接收端（比如 Arduino B）的 RX 引脚上。B 端的任务，就是解读这串莫尔斯电码般的信号。

而​**​语速​**​，就是通信中至关重要的“波特率”（Baud Rate）。它直接决定了一秒钟内传输多少“位”（bit）数据。双方必须预先严格约定好同一个波特率，比如经典的 9600。这意味着每秒传输 9600 个比特。如果发送方以 9600 的速度“说话”，而接收方却以 115200 的速度“聆听”，那么听到的绝对是一堆天书。这就好比你用正常语速对朋友说话，他却用10倍速快进来听，理解根本无从谈起。

数据本身的格式也有讲究。它并不是毫无征兆地突然开始。每发送一个字节（比如一个字母 ‘A’）的数据，它都会被包装成一个​**​数据帧​**​。这个帧以一個“起始位”（一个低电平信号）作为开场锣鼓，意思是“注意，我下面要开始说一个字节了！”。紧接着是8个或9个数据位（这就是 ‘A’ 的二进制真身），最后以一個或多个“停止位”（高电平）收尾，表示“这个字节我说完了，喘口气”。接收方就靠着侦听这个起始位的下降沿来精准地对齐每一位数据，确保中间的数据位被正确读取。

​**​那么，为什么这件事对 Arduino 玩家如此重要？​**​

因为它是你​**​窥探微控制器内心世界​**​的窗口，也是最简单、最可靠的​**​设备间通信​**​方式。你几乎会在每一个 Arduino 项目的开发和调试阶段用到它。

- •
    
    ​**​最经典的用法：调试和打印信息。​**​ 当你写的代码没有按预期工作时，你怎么办？你可以在代码里加上 `Serial.println("Now I'm here!")`和 `Serial.println(sensor_value)`这样的语句。然后打开 Arduino IDE 自带的“串口监视器”，就能看到板子实时打印出来的运行日志和传感器读数。这就像给你的程序安装了一个“黑匣子”，一切内部状态都清晰可见，极大降低了调试难度。
    
- •
    
    ​**​与电脑交互：打造专属控制器。​**​ 你可以写一个简单的 Processing 或 Python 脚本运行在电脑上，通过串口读取 Arduino 发来的传感器数据（比如一个摇杆的位置），然后用它来控制电脑屏幕上的一个游戏角色。反过来，电脑也可以发送指令（比如 ‘1’ 代表开灯，‘0’ 代表关灯）给 Arduino，让它去控制真实的硬件。这样一来，Arduino 就成了连接虚拟数字世界和真实物理世界的桥梁。
    
- •
    
    ​**​双板或多板对话：构建分布式系统。​**​ 就像我们开头说的，你可以让两块 Arduino 通过它们的 TX 和 RX 引脚交叉相连（A的TX接B的RX，A的RX接B的TX），让它们互相传递数据。比如，一块板子负责采集温度和湿度，然后通过串口发送给另一块板子，后者负责显示数据和控制空调开关。这是一种简单且高效的分工合作。
    

所以，USART（串口）远不止是一个枯燥的通信协议。它是嵌入式开发中最基础、最不可或缺的工具之一，是你与芯片沟通的母语。理解了它，你就掌握了让设备“开口说话”的钥匙，你的项目也因此拥有了与更广阔世界连接的能力。从在屏幕上打印一句 “Hello World” 开始，你的创造之路就进入了一个全新的阶段。

## 用Serial通信

### 引脚

其实你的Arduino 数据线不仅可以用来上传代码，还可以支持串口通信。不过，当你用的是数据线来串口通信，那么会占用上传代码的USB端口。所以，一般推荐你买一个USB TO TTL（USB转TTL）。然后按照下面的方式把USB转TTL和Arduino连接起来。注意！RX和TX一起，TX和RX一起！！！

```cpp
USB TO TTL    |     Arduino
VCC                 5v
GND                 GND
RX                  TX
TX                  RX
```

首先你应该要用Serial.begin()函数来初始化USART。你需要给Serial.begin函数传入参数，如下

```cpp
Serial.begin(9600);
```

### 发送数据

如果是为了调试程序，发送字符串的话，可以直接用print和println。如下：

```cpp
Serial.print("hello");
Serial.println(" world");
```

### 接收数据

1. 

```cpp
Serial.read();
```

使用：

```cpp
if (Serial.available() > 0) {  // 检查是否有数据可用
	int incomingByte = Serial.read();  // 读取下一个字节
	if (incomingByte != -1) {
		Serial.print("Received: ");
		Serial.println(incomingByte, DEC);  // 打印接收到的字节
	}
}
```

2. 

```cpp
Serial.peek();
```

使用：

```cpp
if (Serial.available() > 0) {  // 检查是否有数据可用
	int nextByte = Serial.peek();  // 查看下一个字节，但不移除
	if (nextByte != -1) {
		Serial.print("Peeked: ");
		Serial.println(nextByte, DEC);  // 打印查看到的字节
		Serial.read();  // 然后真正读取并移除该字节
	}
}
```

## 参考资料

1. https://blog.csdn.net/hhaowang/article/details/88529842

